<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OSD – Driver Sign-Off</title>
<link rel="icon" href="data:,">
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
<style>
  :root{--ink:#0f172a;--muted:#64748b;--line:#e5e7eb;--brand:#4f46e5}
  *{box-sizing:border-box}
  body{font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;background:#f6f7fb;color:var(--ink);margin:0}
  .container{max-width:960px;margin:24px auto;padding:0 16px}
  .card{background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:0 1px 2px rgba(0,0,0,.05);padding:16px;margin-bottom:16px}
  h1{font-size:28px;margin:8px 0 16px}
  label{display:block;font-size:13px;color:#475569;margin:8px 0 6px}
  input,textarea,select{width:100%;border:1px solid var(--line);border-radius:12px;padding:10px 12px;font-size:14px;outline:none;background:#fff}
  input:focus,textarea:focus,select:focus{border-color:var(--brand)}
  .grid{display:grid;gap:12px}
  @media(min-width:820px){.grid-2{grid-template-columns:1fr 1fr}}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-start}
  .btn{background:var(--brand);color:#fff;border:none;border-radius:12px;padding:10px 16px;font-weight:600;cursor:pointer}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .btn-ghost{background:#eef2ff;color:#111827;border:none;border-radius:10px;padding:8px 12px;cursor:pointer}
  .muted{color:var(--muted);font-size:12px}
  .alert{padding:10px 14px;border-radius:12px;margin:10px 0;font-weight:600}
  .alert.success{background:#e8f7ee;border:1px solid #31a24c;color:#166534}
  .alert.error{background:#fdeaea;border:1px solid #dc2626;color:#7f1d1d}
  .sig{border:1px solid var(--line);border-radius:12px;overflow:hidden}
  .sigbar{display:flex;justify-content:space-between;align-items:center;background:#f8fafc;border-bottom:1px solid var(--line);padding:8px 10px}
  #sigCanvas{display:block;width:100%;height:180px;background:#f9fafb;touch-action:none}
  .thumbs{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px;margin-top:8px}
  .thumbs img{width:100%;height:100px;object-fit:cover;border:1px solid var(--line);border-radius:8px}
  .pill{display:inline-block;padding:2px 8px;border:1px solid var(--line);border-radius:999px;font-size:12px;color:#334155;background:#f8fafc}
</style>
</head>
<body>
<div class="container">
  <h1>OSD – Driver Sign-Off</h1>
  <div id="alert"></div>

  <form id="osdForm" class="card" novalidate>
    <div class="grid grid-2">
      <div>
        <label>Date/Time</label>
        <input type="datetime-local" id="date"/>
      </div>
      <div>
        <label>Door Number *</label>
        <select id="doorNumber" required></select>
      </div>
    </div>

    <div class="row card" style="margin-top:12px">
      <div class="field small">
        <label for="bol">BOL #</label>
        <input id="bol" placeholder="BOL #"/>
      </div>
      <div class="field small">
        <label for="po">PO #</label>
        <input id="po" placeholder="PO #"/>
      </div>
      <div class="field">
        <label for="trailer">Trailer #</label>
        <input id="trailer" placeholder="Trailer #"/>
      </div>
      <div class="field">
        <label for="carrier">Carrier *</label>
        <input id="carrier" placeholder="Carrier" required/>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <label>Photo or PDF of BOL <span id="ocrStatus" class="muted"></span></label>
      <input type="file" id="bolFile" accept="image/*,application/pdf"/>
      <div class="thumbs" id="bolPreview"></div>
      <div id="bolPdfBadge" class="pill" style="display:none">BOL PDF attached</div>

      <label style="margin-top:10px">Digital BOL Link / Load Number (optional)</label>
      <input type="text" id="bolLink" placeholder="Paste a link to the BOL or enter the load number"/>
    </div>

    <div class="row card" style="margin-top:12px">
      <div class="field small">
        <label for="vendorId">Vendor ID</label>
        <input id="vendorId" placeholder="Vendor ID"/>
      </div>
      <div class="field">
        <label for="vendorName">Vendor Name</label>
        <input id="vendorName" placeholder="Vendor Name"/>
      </div>
      <div class="field small">
        <label for="stop">Stop #</label>
        <input id="stop" placeholder="Stop #"/>
      </div>
    </div>

    <div class="card">
      <label>Notes / Exceptions</label>
      <textarea id="notes" rows="5" placeholder="Possible damages, shortages, and overages..."></textarea>
    </div>

    <div class="row">
      <div class="field">
        <label for="driverName">Driver Name *</label>
        <input id="driverName" required/>
      </div>
      <div class="field">
        <label for="proNumber">PRO # / Driver ID (optional)</label>
        <input id="proNumber" placeholder="PRO # or License"/>
      </div>
    </div>

    <div class="sig" style="margin-top:12px">
      <div class="sigbar">
        <span class="muted">Driver signature (draw in the box) *</span>
        <button type="button" class="btn-ghost" id="clearSig">Clear</button>
      </div>
      <canvas id="sigCanvas"></canvas>
    </div>

    <div style="margin-top:12px">
      <label>Photos (optional)</label>
      <input type="file" id="photos" multiple accept="image/*"/>
      <div class="thumbs" id="thumbs"></div>
    </div>

    <div class="row" style="justify-content:space-between;margin-top:12px">
      <button type="button" class="btn-ghost" id="mailtoBtn">Send via Email App</button>
      <button class="btn" id="submitBtn">Submit (Generate & Email PDF)</button>
    </div>
  </form>
</div>

<script>
  const BACKEND_URL = "https://osd-webform.onrender.com";

  (function prefillDate(){
    const d = new Date(), p = n => String(n).padStart(2,'0');
    const val = `${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())}T${p(d.getHours())}:${p(d.getMinutes())}`;
    document.getElementById('date').value = val;
  })();

  (function fillDoors(){
    const sel = document.getElementById('doorNumber');
    const def = document.createElement('option');
    def.value = ""; def.textContent = "Select Door"; sel.appendChild(def);

    for(let i=1;i<=26;i++){
      const o=document.createElement('option');
      o.value=`Door ${i} – 6121 Bixby Rd, Canal Winchester OH 43110`;
      o.textContent=`Door ${i} – 6121 Bixby Rd, Canal Winchester OH 43110`;
      sel.appendChild(o);
    }
    for(let i=17;i<=19;i++){
      const o=document.createElement('option');
      o.value=`Door ${i} – 6121 Bixby Rd, Canal Winchester OH 43110`;
      o.textContent=`Door ${i} – 6121 Bixby Rd, Canal Winchester OH 43110`;
      sel.appendChild(o);
    }
    for(let i=100;i<=140;i++){
      const o=document.createElement('option');
      o.value=`Door ${i}`;
      o.textContent=`Door ${i}`;
      sel.appendChild(o);
    }
  })();

  console.log("Door list updated: includes 1–26, 17–19 (Bixby), 100–140.");
</script>
</body>
</html>
